"use strict";angular.module("myApp",["services.config","ui.router","ui.grid","ui.grid.resizeColumns","ui.grid.pagination","restangular","ui.bootstrap","angular-loading-bar","angular-bind-html-compile"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","RestangularProvider","$provide","configuration",function(e,a,o,t,r,i){var n=window.location.pathname.substring(1),l=window.location.origin;n=n.substring(0,n.indexOf("/"));var c=l+"/"+n+"/";console.log(c),t.setBaseUrl(c),r.decorator("GridOptions",["$delegate","i18nService",function(e,a){var o;return o=angular.copy(e),o.initialize=function(a){var o;return o=e.initialize(a)},a.setCurrentLang("es"),o}]),a.otherwise("/logistica_interna"),e.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController"}).state("app",{url:"/panel",templateUrl:"views/panel/layout.html",controller:"MainController"}).state("app.404",{url:"/404",templateUrl:"404.html"}).state("trasvase_caja",{url:"/trasvase_caja",templateUrl:"views/panel/trasvasecaja.html",controller:"TrasvasecajaController"}).state("logistica_interna",{url:"/logistica_interna",templateUrl:"views/panel/logisticainterna.html",controller:"LogisticainternaController"}).state("logistica_externa",{url:"/logistica_externa",templateUrl:"views/panel/logisticaexterna.html",controller:"LogisticaexternaController"}).state("retorno_valijas",{url:"/retorno_valijas",templateUrl:"views/panel/retornovalijas.html",controller:"RetornovalijaController"}).state("recepcion_control_calidad",{url:"/recepcion_control_calidad",templateUrl:"views/panel/recepcion_control_calidad.html",controller:"RecepcioncontrolcalidadController"}).state("trasvase_retornos",{url:"/trasvase_retornos",templateUrl:"views/panel/trasvaseretornos.html",controller:"TrasvaseretornoController"}).state("retiro_cajas",{url:"/retiro_cajas",templateUrl:"views/panel/retirocajas.html",controller:"RetiroCajasController"}).state("recepcion_captura",{url:"/recepcion_captura",templateUrl:"views/panel/recepcion_captura.html",controller:"RecepcioncapturaController"})}]).run(["$rootScope",function(e){e.version="4.9.12"}]),angular.module("ngLocale",[],["$provide",function(e){var a={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};e.value("$locale",{DATETIME_FORMATS:{AMPMS:["a.m.","p.m."],DAY:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],ERANAMES:["antes de Cristo","después de Cristo"],ERAS:["a. C.","d. C."],FIRSTDAYOFWEEK:6,MONTH:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],SHORTDAY:["dom.","lun.","mar.","mié.","jue.","vie.","sáb."],SHORTMONTH:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],WEEKENDRANGE:[5,6],fullDate:"EEEE, d 'de' MMMM 'de' y",longDate:"d 'de' MMMM 'de' y",medium:"dd/MM/y h:mm:ss a",mediumDate:"dd/MM/y",mediumTime:"h:mm:ss a","short":"dd/MM/yy h:mm a",shortDate:"dd/MM/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-¤",negSuf:"",posPre:"¤",posSuf:""}]},id:"es-mx",pluralCat:function(e,o){return 1==e?a.ONE:a.OTHER}})}]),angular.module("services.config",[]).constant("configuration",{apiEndpoint:"http://localhost/scotiabank-guardavalores/",secure:"false"}),angular.module("myApp").directive("headerPanel",function(){return{templateUrl:"views/directives/header.html",restrict:"E",replace:!0}}),angular.module("myApp").directive("sidebar",function(){return{templateUrl:"views/directives/sidebar.html",restrict:"E",replace:!0}}),angular.module("myApp").directive("footerPanel",function(){return{templateUrl:"views/directives/footer.html",restrict:"E",replace:!0}}),angular.module("myApp").directive("message",function(){return{templateUrl:"views/directives/message.html",restrict:"E",replace:!0,scope:{content:"="}}}),angular.module("myApp").factory("myMaskInterceptor",["$q",function(e){var a=0;return{request:function(o){return 1===++a&&$("#gray-background").show(),o||e.when(o)},response:function(o){return 0===--a&&$("#gray-background").hide(),o||e.when(o)},responseError:function(o){return 0===--a&&$("#gray-background").hide(),e.reject(o)}}}]),angular.module("myApp").factory("ValidaService",function(){var e=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,a=/^[a-zA-Z0-9\.\, ñÑáéíóúüÁÉÍÓÚÜ]*$/,o=/^[a-zA-Z\. ñÑáéíóúÁÉÍÓÚ]*$/,t=/^[a-zA-Z\.\, ñÑáéíóúÁÉÍÓÚ]*$/,r=/^[0-9]*$/,i=/^[0-9]{1,7}(\.[0-9]{1,2})?$/,n=/^[0-9]{1,5}(\.[0-9]{1,2})?$/,l=/^[0-9 \.\-\(\)]*$/,c=/^[0-9 \.\-\(\)ext]*$/,s=/^[a-zA-Z0-9 \.\:\-\(\)]*$/,u=/^[a-zA-Z0-9\. ñÑáéíóúÁÉÍÓÚ\.\,\;\:\_\/\-\_\(\)\[\]\=\*\+]*$/,d=/^([A-ZÑ]{4})([0-9]{6})([A-ZÑ0-9]{3})+$/,f=/^[A-Z]{1}[AEIOU]{1}[A-Z]{2}[0-9]{2}(0[1-9]|1[0-2])(0[1-9]|1[0-9]|2[0-9]|3[0-1])[HM]{1}(AS|BC|BS|CC|CS|CH|CL|CM|DF|DG|GT|GR|HG|JC|MC|MN|MS|NT|NL|OC|PL|QT|QR|SP|SL|SR|TC|TS|TL|VZ|YN|ZS|NE)[B-DF-HJ-NP-TV-Z]{3}[0-9A-Z]{1}[0-9]{1}$/,m=/^[0-9]{5}\/[0-9]{4}$/,p=["dd/MM/yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],v=/^[S][0-9]{8}$/,g=/^[U][0-9]{10}$/,_=/^[C][V][0-9]{6}[ ][0-9]{6}$/,b=/^[G][0-9]{12}$/,h=/^[T][0-9]{11}$/,j=/^[T][0-9]{11}|[U][0-9]{10}$/;return{validamail:function(a){var o=e;return o.test(a)},alfanumerico:function(e){var o=a;return o.test(e)},numerico:function(e){var a=r;return a.test(e)},moneda:function(e){var a=i;return a.test(e)},eshorario:function(e){var a=s;return a.test(e)},esnulo:function(e){return"undefined"==typeof e||null==e||""==e},toUTCDate:function(e){if(void 0==e)return null;var a=e.substring(0,4),o=parseInt(e.substring(5,7)),t=e.substring(8,10),r=e.substring(11,13),i=e.substring(14,16),n=e.substring(17,19),l=new Date(a,o-1,t,r,i,n);return l},StringtoDate:function(e){if(void 0==e)return null;var a=e.split("/"),o=new Date(a[2],a[1]-1,a[0]);return o},dateToString:function(e){if(void 0==e)return null;var a=(e.getDate()<10?"0":"")+e.getDate()+"/"+(e.getMonth()<9?"0":"")+(e.getMonth()+1)+"/"+e.getFullYear();return a},dateToStringYMD:function(e){if(void 0==e)return null;var a=e.getFullYear()+"/"+(e.getMonth()<9?"0":"")+(e.getMonth()+1)+"/"+(e.getDate()<10?"0":"")+e.getDate();return a},dateToISOString:function(e){if(void 0==e)return null;var a=e.toISOString();return a},addZero:function(e){return e<10&&(e="0"+e),e},dateToStringHHmm:function(e){var a=this.addZero(e.getHours())+":"+this.addZero(e.getMinutes());return a},StringtoName:function(e){return null!=e&&(e=e.toLowerCase(),e=e.replace(/ /g,"_"),e=e.replace(/á/g,"a"),e=e.replace(/é/g,"e"),e=e.replace(/í/g,"i"),e=e.replace(/ó/g,"o"),e=e.replace(/ú/g,"u")),e},invertir_cadena:function(e){for(var a=e.length,o="";a>=0;)o+=e.charAt(a),a--;return o},mail_pattern:function(){return e},alfanumerico_pattern:function(){return a},alfanum_simbolos_pattern:function(){return u},numerico_pattern:function(){return r},moneda_pattern:function(){return i},moneda5_pattern:function(){return n},nombre_pattern:function(){return o},nombre_coma_pattern:function(){return t},telefono_pattern:function(){return l},telefono_ext_pattern:function(){return c},horario_pattern:function(){return s},RFC_pattern:function(){return d},CURP_pattern:function(){return f},folio_pattern:function(){return m},caja_pattern:function(){return v},expediente_pattern:function(){return g},precinto_pattern:function(){return _},valija_pattern:function(){return b},documento_pattern:function(){return h},expediente_documento_pattern:function(){return j},formats_date:function(){return p},disabled:function(e){$(e).attr("disabled",!0)},enabled:function(e){$(e).attr("disabled",!1)},get_browser:function(){var e=navigator.appVersion;return e.indexOf("MSIE")!==-1?"MSIE":e.indexOf("Trident")!==-1?"Trident":e.indexOf("Firefox")!==-1?"Firefox":e.indexOf("Chrome")!==-1?"Chrome":e.indexOf("Opera Mini")!==-1?"Opera Mini":e.indexOf("Opera")!==-1?"Opera":e.indexOf("Safari")!==-1?"Safari":"Desconocido"},getAniosCursados:function(e){for(var a=(new Date).getFullYear(),e=e,o=[],t=a;t>=e;t--){var r={};r.id=t,r.nombre=t,o.push(r)}return o},getMeses:function(){for(var e=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],a=[],o=0;o<e.length;o++){var t={};t.id=o+1,t.nombre=e[o],a.push(t)}return a},restaFechas:function(e,a){var o=e-a,t=Math.floor(o/864e5);return t},sumarDiasFecha:function(e,a){var o=parseInt(3024e6),t=e.getDate(),r=e.getMonth()+1,i=e.getFullYear(),n=e.getTime();o=parseInt(24*a*60*60*1e3);e.setTime(n+o);return t=e.getDate(),r=e.getMonth()+1,i=e.getFullYear(),new Date(i,r-1,t)}}}).directive("upperCase",function(){return{require:"ngModel",link:function(e,a,o,t){t.$parsers.unshift(function(e){return void 0!=e&&null!=e&&(e=e.toUpperCase()),e})}}}).directive("validaFechade",["ValidaService",function(e){return{require:"ngModel",link:function(a,o,t,r){r.$parsers.unshift(function(o){if(void 0!==a.busqueda.form.fechaa.$viewValue)var t=e.StringtoDate(a.busqueda.form.fechaa.$viewValue);return null!==o&&(o.setHours(0),o.setMinutes(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),a.busqueda.form.fechaa.$setValidity("vfechafin",t>=o),o})}}}]).directive("validaFechaa",["ValidaService",function(e){return{require:"ngModel",link:function(a,o,t,r){r.$parsers.unshift(function(o){if(void 0!==a.busqueda.form.fechade.$viewValue)var t=e.StringtoDate(a.busqueda.form.fechade.$viewValue);return null!==o&&(o.setHours(0),o.setMinutes(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),r.$setValidity("vfechafin",o>=t),o})}}}]),angular.module("myApp").factory("ConsultaService",["$q","$timeout","Restangular",function(e,a,o){return{getBlobURL:function(e){var a="onmessage = function (event) {                                 var xhr = new XMLHttpRequest();                                 xhr.onreadystatechange=function(){                                if (xhr.readyState==4 && xhr.status==200){                                    postMessage(xhr.responseText);                                }                            };                             xhr.open('GET', '"+e+"' , false);                             xhr.send();                             }";return URL.createObjectURL(new Blob([a]),{type:"application/javascript"})},getBlobURLParam1:function(e,a,o){return this.getBlobURL(e+"?"+a+"="+o)},getBlobURLParams:function(e,a){if(void 0!=a&&null!=a){for(var o="",t=0;t<a.length;t++)o+=a[t].label+"="+a[t].value+(t!=a.length-1?"&":"");return this.getBlobURL(e+"?"+o)}return this.getBlobURL(e)},getWorkerParams:function(a,o){var t=new Worker(this.getBlobURLParams(a,o)),r=e.defer();return t.addEventListener("message",function(e){r.resolve(JSON.parse(e.data))},!1),t.postMessage(""),r.promise},getWorker:function(e){return this.getWorkerParams(e,null)},getRestAngular:function(e){return console.log("metodo"),console.log(e),o.one(e).get()},listRestAngular:function(e,a){return console.log("metodo"),console.log(e),o.all(e).getList(a)},setRestAngular:function(e,a){return console.log("metodo"),console.log(e),console.log("params"),console.log(a),o.all(e).post(a)},getBlobRestAngular:function(e){return console.log("metodo"),console.log(e),o.one(e).withHttpConfig({responseType:"blob"}).customGET()},showBlob:function(e,o){a(function(){var a=navigator.userAgent.toLowerCase();if(a.indexOf("msie")!=-1)window.navigator.msSaveOrOpenBlob(e,o);else if(a.indexOf("chrome")!=-1||a.indexOf("firefox")!=-1||a.indexOf("safari")!=-1){var t=(window.URL||window.webkitURL).createObjectURL(e),r=document.createElement("a");r.setAttribute("download",o),r.setAttribute("href",t),document.body.appendChild(r),r.click(),setTimeout(function(){document.body.removeChild(r),window.URL.revokeObjectURL(t)},100)}else if(a.indexOf("opera")!=-1){var t=(window.URL||window.webkitURL).createObjectURL(e);window.open(t,"_blank")}else a.indexOf("rident")!=-1?window.navigator.msSaveOrOpenBlob(e,o):alert("Desconozco el navegador del que me visitas")})}}}]),angular.module("myApp").factory("UtilService",["$timeout","$q",function(e,a){var o="data:application/vnd.ms-excel;base64,",t='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',r=function(e){return window.btoa(unescape(encodeURIComponent(e)))},i=function(e,a){return e.replace(/{(\w+)}/g,function(e,o){return a[o]})},n={37:1,38:1,39:1,40:1};return{StringtoName:function(e){return null!=e&&(e=e.toLowerCase(),e=e.replace(/ /g,"_"),e=e.replace(/á/g,"a"),e=e.replace(/é/g,"e"),e=e.replace(/í/g,"i"),e=e.replace(/ó/g,"o"),e=e.replace(/ú/g,"u")),e},get_browser:function(){var e=navigator.appVersion;return e.indexOf("MSIE")!==-1?"MSIE":e.indexOf("Trident")!==-1?"Trident":e.indexOf("Firefox")!==-1?"Firefox":e.indexOf("Chrome")!==-1?"Chrome":e.indexOf("Opera Mini")!==-1?"Opera Mini":e.indexOf("Opera")!==-1?"Opera":e.indexOf("Safari")!==-1?"Safari":"Desconocido"},tableToExcel:function(e,a){var n=this.StringtoName(a),l=$("#"+e),c={worksheet:a,table:l.html()},s=o+r(i(t,c)),u=document.createElement("a");u.href=s,u.download=n+".xls";var d=this.get_browser();return"Chrome"==d?(u.click(),null):u},preventDefault:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1},preventDefaultForScrollKeys:function(e){if(n[e.keyCode])return preventDefault(e),!1},disableScroll:function(){window.addEventListener&&window.addEventListener("DOMMouseScroll",this.preventDefault,!1),window.onwheel=this.preventDefault,window.onmousewheel=document.onmousewheel=this.preventDefault,window.ontouchmove=this.preventDefault,document.onkeydown=this.preventDefaultForScrollKeys},enableScroll:function(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",this.preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null},pieChart:function(){return{chart:{type:"pieChart",height:250,x:function(e){return e.key},y:function(e){return e.y},showLabels:!0,valueFormat:function(e){return d3.format(",.0f")(e)},duration:500,labelThreshold:.01,labelSunbeamLayout:!0,legendPosition:"top",noData:"No hay datos que mostrar",legend:{margin:{top:5,right:10,bottom:0,left:0}}}}},barChart:function(){return{chart:{type:"multiBarChart",height:250,margin:{top:20,right:20,bottom:120,left:45},clipEdge:!0,duration:500,stacked:!1,wrapLabels:!0,noData:"No hay datos que mostrar",controlLabels:{grouped:"Agrupados",stacked:"Apilados"},xAxis:{axisLabel:"",showMaxMin:!1,tickFormat:function(e){return e}},yAxis:{axisLabel:"",axisLabelDistance:-20,tickFormat:function(e){return d3.format(",.0f")(e)}}}}},gridOptions:function(){return{enableColumnMenus:!1,enableColumnResizing:!0,enableFiltering:!1,maxVisibleColumnCount:1e5,paginationPageSizes:[10,25,50,100],paginationPageSize:10,data:"result"}}}}]),angular.module("myApp").factory("MessageService",function(){return{getMessage:function(e,a){var o='<div ng-if="true">\n                                       <div class="alert alert-content.type alert-dismissible" role="alert">\n                                        <button type="button" class="close" ng-click="close_message()" aria-label="Close"><span\n                                            aria-hidden="true">&times;</span></button>\n                                            content.text\n                                            </div>\n                                       </div>';return o=o.replace("content.show","true"),o=o.replace("content.text",e),o=o.replace("content.type",a)},success:function(e,a){e.message={},e.message.html=this.getMessage(a,"success")},error:function(e,a){e.message={},e.message.html=this.getMessage(a,"danger"),console.log(e.message.html)},warning:function(e,a){e.message={},e.message.html=this.getMessage(a,"warning")},info:function(e,a){e.message={},e.message.html=this.getMessage(a,"info")},close:function(e){e.message={},e.message.html=null}}}),angular.module("myApp").service("sharedProperties",function(){var e={},a=[],o={};return{getObject:function(){return console.log("getObject"),console.log(e),e},setObject:function(a){console.log("setObject"),console.log(a),e=a},getList:function(){return console.log("getList"),console.log(a),a},setList:function(e){a=e,console.log("setList"),console.log(a)},getEstado:function(){return console.log("getEstado"),console.log(o),o},setEstado:function(e){o=e,console.log("setEstado"),console.log(o)}}}),angular.module("myApp").controller("MainController",["$scope","$rootScope","$state",function(e,a,o){a.class_menu="sidebar-mini",e.bcollapse=!1,e.collapse=function(){e.bcollapse?a.class_menu="sidebar-mini":a.class_menu="sidebar-mini sidebar-collapse",e.bcollapse=!e.bcollapse},e.logout=function(){o.go("login")}}]),angular.module("myApp").controller("LoginController",["$scope","$state","ConsultaService","MessageService",function(e,a,o,t){e.usuario={},e.ingresar=function(){var t={usuario:e.usuario.login,password:e.usuario.password};o.setRestAngular("login",t).then(function(e){console.log(e),a.go("app.captcha")})["catch"](function(a){console.log("Exception: "),console.log(a),e.usuario.password=null,e.mensaje="Usuario o contraseña incorrecta"})}}]),angular.module("myApp").controller("TrasvasecajaController",["$scope","$timeout","$modal","$rootScope","$stateParams","ValidaService","ConsultaService","MessageService","sharedProperties",function(e,a,o,t,r,i,n,l,c){function s(){var a={idtrasvase:null,usuario:null,fechaRegistro:null,cajaId:Number(e.cat.cajaId.substring(1)),precinto:null,status:0,precinto2:null};n.setRestAngular("trasvasecajacab.action",a).then(function(a){console.log(a),e.cat.idtrasvase=a.idtrasvase,c.setObject(e.cat),e.habilitainput("operatoria"),e.limpiar_error(),e.listar_etiquetas()})["catch"](function(a){console.log(a),e.forma.form.caja.$setValidity("error_caja",!1),e.error.error_caja=a.data.men})}e.forma={},e.cat={},e.error={},e.deta={},e.bhabilita_cerrar=!1,e.caja_pattern=i.caja_pattern(),e.expediente_pattern=i.expediente_pattern(),e.get_operatorias=function(){n.listRestAngular("operatorias.action",null).then(function(a){console.log(a),e.operatoriaslist=a})["catch"](function(e){console.log(e)})},e.get_operatorias(),e.guardar_cab=function(){return console.log(e.cat.cajaId),void 0==e.cat.cajaId?void e.forma.form.caja.$setValidity("required",!1):void n.getRestAngular("valida_caja.action?cajaId="+e.cat.cajaId.substring(1)).then(function(a){console.log(a),console.log(a.status),null==a.status||void 0==a.status?s():(e.cat.idtrasvase=a.trasvase.idtrasvase,c.setObject(e.cat),e.habilitainput("operatoria"),e.listar_etiquetas(),e.limpiar_error())})["catch"](function(a){if(console.log(a),a.data.men.indexOf("trasvase activo")!==-1){var o=window.confirm(a.data.men+"\n¿Deseas cancelar el trasvase activo para poder ocuparla?");1==o&&n.getRestAngular("cancelatrasvase.action?idtrasvase="+a.data.SbTrasvaseCajaCab.idtrasvase).then(function(e){console.log(e),s()})["catch"](function(e){console.log(e)})}else e.forma.form.caja.$setValidity("error_caja",!1),e.error.error_caja=a.data.men})},e.guardar_deta=function(){return void 0==e.cat.etiqueta?void e.forma.form.etiqueta.$setValidity("required",!1):void n.getRestAngular("valida_expediente.action?nunicodoc="+e.cat.etiqueta.substring(1)).then(function(a){console.log(a);var o={pk:{idtrasvase:e.cat.idtrasvase,etiqueta:Number(e.cat.etiqueta.substring(1))},idoperatoria:e.cat.idoperatoria,scltcod:null,status:null,fechaRegistro:null,usuario:null,tipoEtiqueta:"U"};n.setRestAngular("trasvasecajadeta.action",o).then(function(a){console.log(a),e.cat.etiqueta=void 0,e.listar_etiquetas(),e.limpiar_error()})["catch"](function(a){console.log(a),e.forma.form.etiqueta.$setValidity("error_etiqueta",!1),e.error.error_etiqueta=a.data.men,e.cat.etiqueta=void 0,$("#etiqueta").val(null)})})["catch"](function(a){console.log(a),e.forma.form.etiqueta.$setValidity("error_etiqueta",!1),e.error.error_etiqueta=a.data.men,e.cat.etiqueta=void 0,$("#etiqueta").val(null)})},e.listar_etiquetas=function(){n.listRestAngular("trasvasecajadeta.action?idtrasvase="+e.cat.idtrasvase,null).then(function(a){console.log(a),e.etiquetaslist=a})["catch"](function(a){e.etiquetaslist=[],console.log(a)})},e.deshabilita_cerrar=function(){if(void 0!=e.etiquetaslist){e.etiquetaslist.length>0;return!1}return!0},e.close_message=function(){l.close(e)},e.$watch("cat.idoperatoria",function(a,o){void 0!==e.forma.form&&(void 0!=a&&""!=a?n.getRestAngular("valida_caja_operatoria.action?cajaId="+e.cat.cajaId.substring(1)+"&idoperatoria="+e.cat.idoperatoria).then(function(a){e.habilitainput("etiqueta"),e.forma.form.operatoria.$setValidity("required",!0),e.forma.form.caja.$invalid=!1,e.forma.form.caja.$setValidity("error_caja",!0)})["catch"](function(a){console.log(a),e.habilitainput("operatoria"),e.forma.form.caja.$setValidity("error_caja",!1),e.error.error_caja=a.data.men}):void 0!=e.cat.cajaId&&(e.habilitainput("operatoria"),e.forma.form.operatoria.$setValidity("required",!1)))}),e.limpiar_error=function(){e.error={},e.forma.form.$error={},e.forma.form.caja.$error={},e.forma.form.etiqueta.$error={},e.forma.form.caja.$invalid=!1,e.forma.form.etiqueta.$invalid=!1},e.limpiar=function(){e.habilitainput("caja"),e.cat={},e.etiquetaslist=[],e.limpiar_error(),$("#etiqueta").val(null),$("#caja").val(null),$("#operatoria").val(""),e.close_message()},e.habilitainput=function(a){switch(e.bcaja=!1,e.boperatoria=!1,e.betiqueta=!1,a){case"caja":e.bcaja=!0;break;case"operatoria":e.boperatoria=!0;break;case"etiqueta":e.boperatoria=!0,e.betiqueta=!0}},e.habilitainput("caja"),e.cerrar_caja=function(){e.openmodal()},e.quitar_item=function(a){var o=window.confirm("¿En verdad deseas borrar el expediente U0"+a+"?");1==o&&n.getRestAngular("deltrasvasecajadeta.action?idtrasvase="+e.cat.idtrasvase+"&etiqueta="+a).then(function(a){e.listar_etiquetas()})["catch"](function(e){console.log(e)})},e.openmodal=function(){o.open({animation:!0,templateUrl:"views/directives/modal_precinto.html",controller:"ModalController",backdrop:"static",keyboard:!1})},e.$watchCollection("etiquetaslist",function(a,o){void 0!==e.forma.form&&void 0!=a&&(e.bhabilita_cerrar=a.length>0)}),t.$on("CerrarCajaConfirm",function(){e.cerrar_caja_confirm()}),e.cerrar_caja_confirm=function(){var a=c.getObject(),o={idtrasvase:e.cat.idtrasvase,usuario:null,fechaRegistro:null,cajaId:null,precinto:a.precinto,status:1,precinto2:a.precinto2};n.setRestAngular("uptrasvasecajacab.action",o).then(function(a){console.log(a),e.limpiar(),alert("La caja se ha cerrado correctamente.")})["catch"](function(a){console.log(a),l.error(e,a.data.men)})}}]),angular.module("myApp").controller("ModalController",["$scope","$modal","$modalInstance","$rootScope","ValidaService","sharedProperties","ConsultaService",function(e,a,o,t,r,i,n){e.modalform={},e.catform={},e.precinto_pattern=r.precinto_pattern(),e.close=function(){o.close()},e.cerrar_caja_confirm=function(){if(void 0!==e.modalform.form){if(!e.modalform.form.$valid)return void alert("Es necesario colocar los precintos para cerrar la caja.");o.close();var a=i.getObject();a.precinto=e.catform.precinto,a.precinto2=e.catform.precinto2,i.setObject(a),t.$emit("CerrarCajaConfirm",{})}},e.$watch("catform.precinto",function(a,o){void 0!==e.modalform.form&&void 0!=a&&""!=a&&(e.catform.precinto==e.catform.precinto2?e.modalform.form.precinto2.$setValidity("error_precinto",!1):e.modalform.form.precinto2.$setValidity("error_precinto",!0))}),e.$watch("catform.precinto2",function(a,o){void 0!==e.modalform.form&&void 0!=a&&""!=a&&(e.catform.precinto==e.catform.precinto2?e.modalform.form.precinto2.$setValidity("error_precinto",!1):e.modalform.form.precinto2.$setValidity("error_precinto",!0))})}]),angular.module("myApp").controller("LogisticainternaController",["$scope","$timeout","$modal","$rootScope","$stateParams","ValidaService","ConsultaService","MessageService","sharedProperties",function(e,a,o,t,r,i,n,l,c){e.forma={},e.cat={},e.cat.totalValijas=0,e.valija={},e.error={},e.deta={},e.valijaslist=[],e.bhabilita_guardar=!1,e.bhabilita_faltantes=!1,e.numerico_pattern=i.numerico_pattern(),e.valija_pattern=i.valija_pattern(),e.precinto_pattern=i.precinto_pattern(),e.validar_lote=function(){return console.log(e.cat.idLote),void 0===e.cat.idLote||null===e.cat.idLote?void e.forma.form.lote.$setValidity("required",!1):void n.getRestAngular("valida_lote.action?idLote="+e.cat.idLote).then(function(a){console.log("lote"),console.log(a),e.cat=a,e.get_usuario(),e.habilitainput("valija"),e.listar_valijas(),c.setObject(e.cat),e.forma.form.lote.$invalid=!1,e.forma.form.lote.$error={},e.forma.form.persona_entrega.$touched=!0})["catch"](function(a){console.log(a),e.forma.form.lote.$setValidity("error_lote",!1),e.error.error_lote=a.data.men})},e.get_usuario=function(){n.getRestAngular("usuario.action").then(function(a){console.log("usuario"),console.log(a),e.cat.personaRecibe=a.user.nombre})["catch"](function(e){console.log(e)})},e.valija_action=function(){void 0!==e.valija.svalija&&$("#precinto").focus()},e.validar_valija=function(){if(void 0===e.valija.svalija||null===e.valija.svalija)return void e.forma.form.valija.$setValidity("required",!1);if(void 0===e.valija.precinto||null===e.valija.precinto)return void e.forma.form.precinto.$setValidity("required",!1);if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("Debes colocar el nombre de la persona que recibe");var a={pk:{idLote:e.cat.idLote,nunico:Number(e.valija.svalija.substring(1))},scltcod:null,precinto:e.valija.precinto,fecha:null,usuario:null,status:2};n.setRestAngular("valida_lote_valijas.action",a).then(function(a){console.log(a),e.listar_valijas()})["catch"](function(a){console.log(a),e.forma.form.valija.$setValidity("error_valija",!1),e.error.error_valija=a.data.men}),e.valija.svalija=void 0,e.valija.precinto=void 0,$("#valija").val(null),$("#precinto").val(null),e.error={},e.forma.form.$error={},e.forma.form.valija.$error={},e.forma.form.valija.$touched=!1,$("#valija").focus()},e.listar_valijas=function(){n.listRestAngular("lista_lote_valijas.action?idLote="+e.cat.idLote+"&status=2",null).then(function(a){console.log("valijaslist"),console.log(a),e.valijaslist=a,e.bhabilita_faltantes=e.valijaslist.length<e.cat.totalValijas})["catch"](function(a){console.log(a),e.bhabilita_faltantes=!0})},e.close_message=function(){l.close(e)},e.limpiar_error=function(){e.error={},e.forma.form.$error={},e.forma.form.lote.$error={},e.forma.form.valija.$error={},e.forma.form.persona_entrega.$error={},e.forma.form.persona_recibe.$error={},e.forma.form.persona_entrega.$invalid=!1,e.forma.form.lote.$touched=!1,e.forma.form.valija.$touched=!1,e.forma.form.persona_entrega.$touched=!1,e.forma.form.persona_recibe.$touched=!1,e.bhabilita_faltantes=!1},e.habilitainput=function(a){switch(e.blote=!1,e.bpersonas=!1,e.bvalija=!1,a){case"lote":e.blote=!0;break;case"valija":e.bvalija=!0}},e.habilitainput("lote"),e.limpiar=function(){e.cat={},e.cat.totalValijas=0,e.valija={},e.valijaslist=[],$("#valija").val(null),$("#precinto").val(null),$("#lote").val(null),$("#persona_entrega").val(null),$("#persona_recibe").val(null),e.habilitainput("lote"),e.limpiar_error(),e.close_message()},e.listar_valijas_guardadas=function(){n.listRestAngular("lista_lote_valijas.action?idLote="+e.cat.idLote+"&status=2",null).then(function(e){console.log("valijaslist guardadas"),console.log(e),c.setList(e)})["catch"](function(e){console.log(e)})},e.guardar_restante=function(){e.limpiar_error(),e.limpiar(),o.open({animation:!0,templateUrl:"views/directives/modal_creado.html",controller:"CreadoController",backdrop:"static",keyboard:!1})},e.guardar=function(){if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("Debes colocar el nombre de la persona que recibe");var a=window.confirm("¿En verdad deseas cerrar el lote?");if(1==a){var o=e.cat.idLote,t={idLote:o,scltcod:null,fecha:null,usuario:null,personaEntrega:e.cat.personaEntrega,personaRecibe:e.cat.personaRecibe};n.setRestAngular("save_lote_logistica.action",t).then(function(a){console.log("save_lote_logistica.action"),console.log(a),n.listRestAngular("lista_lote_valijas.action?idLote="+e.cat.idLote+"&status=2",null).then(function(a){console.log("valijaslist guardadas"),console.log(a),c.setList(a),e.guardar_restante()})["catch"](function(a){console.log(a),e.bhabilita_faltantes=!0,e.guardar_restante()})})["catch"](function(a){console.log(a),l.error(e,a.data.men)})}},e.ver_modal=function(){o.open({animation:!0,templateUrl:"views/directives/modal_creado.html",controller:"CreadoController",backdrop:"static",keyboard:!1})},e.ver_faltantes=function(){o.open({animation:!0,templateUrl:"views/directives/modal_faltantes.html",controller:"FaltantesController",backdrop:"static",keyboard:!1})},e.$watchCollection("valijaslist",function(a,o){void 0!==e.forma.form&&void 0!=a&&a.length>0&&(e.bhabilita_guardar=a.length==e.cat.totalValijas)})}]),angular.module("myApp").controller("FaltantesController",["$scope","$modal","$timeout","$modalInstance","ConsultaService","sharedProperties","UtilService",function(e,a,o,t,r,i,n){e.modalform={},e.faltanteslist=[];var l=i.getObject();e.close=function(){t.close()},e.listar_faltantes=function(){r.listRestAngular("lista_lote_valijas.action?idLote="+l.idLote+"&status=1",null).then(function(a){console.log("faltantes"),console.log(a),e.faltanteslist=a})["catch"](function(e){console.log(e)})},e.listar_faltantes(),e.exportar_faltantes=function(e){var a=n.tableToExcel(e,"valijas faltantes");null!==a&&o(function(){location.href=a},100)}}]),angular.module("myApp").controller("CreadoController",["$scope","$modal","$timeout","$modalInstance","ConsultaService","sharedProperties","UtilService",function(e,a,o,t,r,i,n){e.modalform={},e.modal={},e.bdescargado=!1,e.bexcel=!1,e.status_leidas=2;var l=i.getObject();e.valijas_leidas=i.getList(),console.log("$scope.valijas_leidas"),console.log(e.valijas_leidas),e.close=function(){t.close()},e.show_message=function(){e.modal.mensaje="El lote "+l.idLote+" se ha cerrado correctamente."},e.show_message(),e.descargar_remito=function(){e.bdescargado=!0,r.getBlobRestAngular("remito_logistica_adea.action?idLote="+l.idLote+"&status=2").then(function(e){console.log(e),r.showBlob(e,"remito_lote_"+l.idLote+".pdf")})["catch"](function(e){console.log(e)})},e.descargar_excel=function(a){e.bexcel=!0;var t=n.tableToExcel(a,"valijas recibidas");null!==t&&o(function(){location.href=t},100)}}]),angular.module("myApp").controller("LogisticaexternaController",["$scope","$timeout","$modal","$rootScope","$stateParams","ValidaService","ConsultaService","MessageService","sharedProperties",function(e,a,o,t,r,i,n,l,c){e.forma={},e.cat={},e.cat.totalValijas=0,e.valija={},e.error={},e.deta={},e.valijaslist=[],e.bhabilita_guardar=!1,e.bhabilita_parcial=!1,e.bhabilita_faltantes=!1,e.numerico_pattern=i.numerico_pattern(),e.valija_pattern=i.valija_pattern(),e.precinto_pattern=i.precinto_pattern(),e.validar_lote=function(){return console.log(e.cat.idLote),void 0===e.cat.idLote||null===e.cat.idLote?void e.forma.form.lote.$setValidity("required",!1):void n.getRestAngular("valida_lote_banco.action?idLote="+e.cat.idLote).then(function(a){console.log("lote"),console.log(a),e.cat=a,e.get_usuario(),e.habilitainput("valija"),e.listar_valijas(),c.setObject(e.cat),e.forma.form.lote.$invalid=!1,e.forma.form.lote.$error={},
e.forma.form.persona_entrega.$touched=!0})["catch"](function(a){console.log(a),e.forma.form.lote.$setValidity("error_lote",!1),e.error.error_lote=a.data.men})},e.get_usuario=function(){n.getRestAngular("persona_entrega_recibe.action?idLote="+e.cat.idLote+"&status=2").then(function(a){console.log("usuario"),console.log(a),e.cat.personaEntrega=a.personaEntrega,e.cat.personaRecibe=a.personaRecibe})["catch"](function(e){console.log(e)})},e.valija_action=function(){void 0!==e.valija.svalija&&$("#precinto").focus()},e.validar_valija=function(){if(void 0===e.valija.svalija||null===e.valija.svalija)return void e.forma.form.valija.$setValidity("required",!1);if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("Debes colocar el nombre de la persona que recibe");var a={pk:{idLote:e.cat.idLote,nunico:Number(e.valija.svalija.substring(1))},scltcod:null,precinto:e.valija.precinto,fecha:null,usuario:null,status:6};n.setRestAngular("valida_lote_valijas_banco.action",a).then(function(a){console.log(a),e.listar_valijas()})["catch"](function(a){console.log(a),e.forma.form.valija.$setValidity("error_valija",!1),e.error.error_valija=a.data.men}),e.valija.svalija=void 0,e.valija.precinto=void 0,$("#valija").val(null),$("#precinto").val(null),e.error={},e.forma.form.$error={},e.forma.form.valija.$error={},e.forma.form.precinto.$error={},e.forma.form.valija.$touched=!1,e.forma.form.precinto.$touched=!1,$("#valija").focus()},e.listar_valijas=function(){n.listRestAngular("lista_lote_valijas_banco.action?idLote="+e.cat.idLote+"&status=7",null).then(function(a){console.log("valijaslist"),console.log(a),e.valijaslist=a,e.bhabilita_faltantes=e.valijaslist.length<e.cat.totalValijas})["catch"](function(a){console.log(a),e.bhabilita_faltantes=!0})},e.close_message=function(){l.close(e)},e.limpiar_error=function(){e.error={},e.forma.form.$error={},e.forma.form.lote.$error={},e.forma.form.valija.$error={},e.forma.form.precinto.$error={},e.forma.form.persona_entrega.$error={},e.forma.form.persona_recibe.$error={},e.forma.form.persona_entrega.$invalid=!1,e.forma.form.lote.$touched=!1,e.forma.form.valija.$touched=!1,e.forma.form.precinto.$touched=!1,e.forma.form.persona_entrega.$touched=!1,e.forma.form.persona_recibe.$touched=!1,e.bhabilita_faltantes=!1,e.bhabilita_parcial=!1},e.habilitainput=function(a){switch(e.blote=!1,e.bpersonas=!1,e.bvalija=!1,a){case"lote":e.blote=!0;break;case"valija":e.bvalija=!0}},e.habilitainput("lote"),e.limpiar=function(){e.cat={},e.cat.totalValijas=0,e.valija={},e.valijaslist=[],$("#valija").val(null),$("#precinto").val(null),$("#lote").val(null),$("#persona_entrega").val(null),$("#persona_recibe").val(null),e.habilitainput("lote"),e.limpiar_error(),e.close_message()},e.guardar_parcial_restante2=function(){console.log("guardar_parcial_restante2"),c.setEstado("PARCIAL"),c.setObject(e.cat),c.setList(e.valijas_leidas),e.limpiar(),o.open({animation:!0,templateUrl:"views/directives/modal_creado.html",controller:"CreadoBancoController",backdrop:"static",keyboard:!1})},e.guardar_parcialmente=function(){if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("Debes colocar el nombre de la persona que recibe");var a=window.confirm("¿En verdad deseas cerrar parcialmente el lote?");if(1==a){var o={idLote:e.cat.idLote,scltcod:null,fecha:null,usuario:null,status:6,personaEntrega:e.cat.personaEntrega,personaRecibe:e.cat.personaRecibe};n.setRestAngular("save_lote_logistica_banco.action",o).then(function(a){console.log(a),n.listRestAngular("lista_lote_valijas.action?idLote="+e.cat.idLote+"&status=7",null).then(function(a){console.log("valijaslist leidas"),console.log(a),e.valijas_leidas=a,e.guardar_parcial_restante2()})["catch"](function(a){e.valijas_leidas=[],e.guardar_parcial_restante2(),console.log(a)})})["catch"](function(a){console.log(a),e.guardar_restante()})}},e.guardar_restante=function(){c.setEstado("COMPLETO"),e.limpiar(),o.open({animation:!0,templateUrl:"views/directives/modal_creado.html",controller:"CreadoBancoController",backdrop:"static",keyboard:!1})},e.guardar=function(){if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("Debes colocar el nombre de la persona que recibe");var a=window.confirm("¿En verdad deseas cerrar el lote?");if(1==a){var o=e.cat.idLote,t={idLote:o,scltcod:null,fecha:null,usuario:null,status:7,personaEntrega:e.cat.personaEntrega,personaRecibe:e.cat.personaRecibe};n.setRestAngular("save_lote_logistica_banco.action",t).then(function(a){console.log(a),n.listRestAngular("lista_lote_valijas.action?idLote="+o+"&status=7",null).then(function(a){console.log("valijaslist leidas"),console.log(a),c.setList(a),e.guardar_restante()})["catch"](function(a){console.log(a),e.guardar_restante()})})["catch"](function(a){console.log(a),e.guardar_restante()})}},e.ver_faltantes=function(){o.open({animation:!0,templateUrl:"views/directives/modal_faltantes.html",controller:"FaltantesBancoController",backdrop:"static",keyboard:!1})},e.$watchCollection("valijaslist",function(a,o){void 0!==e.forma.form&&void 0!=a&&a.length>0&&(e.bhabilita_guardar=a.length==e.cat.totalValijas,e.bhabilita_parcial=a.length<e.cat.totalValijas)})}]),angular.module("myApp").controller("FaltantesBancoController",["$scope","$modal","$modalInstance","ConsultaService","sharedProperties","UtilService",function(e,a,o,t,r,i){e.modalform={},e.faltanteslist=[],e.close=function(){o.close()},e.listar_faltantes=function(){var a=r.getObject();t.listRestAngular("lista_lote_valijas_banco.action?idLote="+a.idLote+"&status=4",null).then(function(a){console.log("faltantes"),console.log(a);for(var o=0;o<a.length;o++)4==a[o].status&&e.faltanteslist.push(a[o])})["catch"](function(e){console.log(e)})},e.listar_faltantes(),e.exportar_faltantes=function(e){var a=i.tableToExcel(e,"valijas faltantes");null!==a&&$timeout(function(){location.href=a},100)}}]),angular.module("myApp").controller("CreadoBancoController",["$scope","$modal","$timeout","$modalInstance","ConsultaService","sharedProperties","UtilService",function(e,a,o,t,r,i,n){e.modalform={},e.modal={},e.bdescargado=!1,e.bexcel=!1,e.status_leidas;var l=i.getObject(),c=i.getEstado();console.log(c),e.valijas_leidas=i.getList(),console.log("$scope.valijas_leidas"),console.log(e.valijas_leidas),e.close=function(){t.close()},e.show_message=function(){"PARCIAL"==c?(e.status_leidas=7,e.modal.mensaje="El lote "+l.idLote+" se ha cerrado parcialmente."):(e.status_leidas=7,e.modal.mensaje="El lote "+l.idLote+" se ha cerrado correctamente.")},e.show_message(),e.descargar_remito=function(){e.bdescargado=!0;var a;a="PARCIAL"==c?"remito_logistica_banco.action?idLote="+l.idLote+"&status=6":"remito_logistica_banco.action?idLote="+l.idLote+"&status=7",r.getBlobRestAngular(a).then(function(e){console.log(e),r.showBlob(e,"remito_lote_"+l.idLote+".pdf")})["catch"](function(e){console.log(e)})},e.descargar_excel=function(a){e.bexcel=!0;var t=n.tableToExcel(a,"valijas recibidas");null!==t&&o(function(){location.href=t},100)}}]),angular.module("myApp").controller("RetornovalijaController",["$scope","$timeout","$modal","ValidaService","ConsultaService",function(e,a,o,t,r){e.forma={},e.cat={},e.valija={},e.mensaje={},e.error={},e.valija_pattern=t.valija_pattern(),e.agregar=function(){if(void 0==e.cat.svalija)return void e.forma.form.valija.$setValidity("required",!1);e.mensaje={};var a=e.cat.svalija;e.cat={},e.valija={},r.getRestAngular("valida_valija.action?svalija="+a).then(function(o){console.log(o),e.valija=o,e.mensaje.bcorrecto=!0,e.mensaje.texto="La valija "+a+" se actualizó a estado disponible"})["catch"](function(a){console.log(a),e.mensaje.berror=!0,e.mensaje.texto=a.data.men})},e.limpiar_error=function(){e.error={},e.forma.form.$error={},e.mensaje={},e.forma.form.valija.$error={},e.forma.form.valija.$invalid=!1},e.limpiar=function(){e.cat={},e.valija={},e.limpiar_error(),$("#valija").val(null)}}]),angular.module("myApp").controller("TrasvaseretornoController",["$scope","$timeout","$modal","$rootScope","$stateParams","ValidaService","ConsultaService","MessageService","sharedProperties",function(e,a,o,t,r,i,n,l,c){function s(){var a={idtrasvase:null,usuario:null,fechaRegistro:null,cajaId:Number(e.cat.cajaId.substring(1)),precinto:null,status:0,precinto2:null,tipoTrasvase:null,subTipoTrasvase:e.cat.subTipoTrasvase};n.setRestAngular("trasvasecajacab_retorno.action",a).then(function(a){console.log(a),e.cat.idtrasvase=a.idtrasvase,e.cat.subTipoTrasvase=a.subTipoTrasvase,c.setObject(e.cat),e.habilitainput("caja"),e.limpiar_error(),e.listar_etiquetas()})["catch"](function(a){console.log(a),e.forma.form.caja.$setValidity("error_caja",!1),e.error.error_caja=a.data.men})}e.forma={},e.cat={},e.error={},e.deta={},e.bhabilita_cerrar=!1,e.caja_pattern=i.caja_pattern(),e.expediente_documento_pattern=i.expediente_documento_pattern(),e.get_operatorias=function(){n.listRestAngular("operatorias_retorno.action",null).then(function(a){console.log(a),e.operatoriaslist=a})["catch"](function(e){console.log(e)})},e.get_operatorias(),e.guardar_cab=function(){return console.log(e.cat.subTipoTrasvase),void 0==e.cat.subTipoTrasvase?void e.forma.form.control.$setValidity("required",!1):void n.getRestAngular("valida_caja_retorno.action?cajaId="+e.cat.cajaId.substring(1)+"&subTipoTrasvase="+e.cat.subTipoTrasvase).then(function(a){console.log(a),console.log(a.status),null==a.status||void 0==a.status?s():(e.cat.idtrasvase=a.trasvase.idtrasvase,e.cat.subTipoTrasvase=a.trasvase.subTipoTrasvase,c.setObject(e.cat),e.habilitainput("caja"),e.listar_etiquetas(),e.limpiar_error())})["catch"](function(a){if(console.log(a),a.data.men.indexOf("trasvase activo")!==-1){var o=window.confirm(a.data.men+"\n¿Deseas cancelar el trasvase activo para poder ocuparla?");1==o&&n.getRestAngular("cancelatrasvase.action?idtrasvase="+a.data.SbTrasvaseCajaCab.idtrasvase).then(function(e){console.log(e),s()})["catch"](function(e){console.log(e)})}else e.forma.form.caja.$setValidity("error_caja",!1),e.error.error_caja=a.data.men})},e.guardar_deta=function(){return void 0==e.cat.etiqueta?void e.forma.form.etiqueta.$setValidity("required",!1):void n.getRestAngular("valida_expediente_documento_retorno.action?etiqueta="+e.cat.etiqueta+"&control="+e.cat.subTipoTrasvase).then(function(a){console.log(a);var o;o="ING"===e.cat.subTipoTrasvase||"INT"===e.cat.subTipoTrasvase?e.cat.idoperatoria:a.idoperatoria;var t={pk:{idtrasvase:e.cat.idtrasvase,etiqueta:Number(e.cat.etiqueta.substring(1))},idoperatoria:o,scltcod:null,status:null,fechaRegistro:null,usuario:null,tipoEtiqueta:e.cat.etiqueta.substring(0,1)};n.setRestAngular("trasvasecajadeta_retorno.action",t).then(function(a){console.log(a),e.cat.etiqueta=void 0,e.listar_etiquetas(),e.limpiar_error()})["catch"](function(a){console.log(a),e.forma.form.etiqueta.$setValidity("error_etiqueta",!1),e.error.error_etiqueta=a.data.men,e.cat.etiqueta=void 0,$("#etiqueta").val(null)})})["catch"](function(a){console.log(a),e.forma.form.etiqueta.$setValidity("error_etiqueta",!1),e.error.error_etiqueta=a.data.men,e.cat.etiqueta=void 0,$("#etiqueta").val(null)})},e.listar_etiquetas=function(){n.listRestAngular("trasvasecajadeta_retorno.action?idtrasvase="+e.cat.idtrasvase,null).then(function(a){console.log(a),e.etiquetaslist=a,e.etiquetaslist.length>0&&(e.bcontrol=!1)})["catch"](function(e){console.log(e)})},e.deshabilita_cerrar=function(){if(void 0!=e.etiquetaslist){e.etiquetaslist.length>0;return!1}return!0},e.close_message=function(){l.close(e)},e.$watch("cat.subTipoTrasvase",function(a,o){void 0!==e.forma.form&&(void 0!=a&&""!=a?(e.habilitainput("control"),e.forma.form.control.$setValidity("required",!0),e.cat.idoperatoria=void 0):e.boperatoria=!1)}),e.$watch("cat.idoperatoria",function(a,o){void 0!==e.forma.form&&(void 0!=a&&""!=a?(e.habilitainput("operatoria"),e.forma.form.operatoria.$setValidity("required",!0),e.betiqueta=!0):void 0!=e.cat.subTipoTrasvase&&(e.habilitainput("caja"),e.forma.form.operatoria.$setValidity("required",!1)))}),e.limpiar_error=function(){e.error={},e.forma.form.$error={},e.forma.form.caja.$error={},e.forma.form.etiqueta.$error={},e.forma.form.control.$error={},e.forma.form.caja.$invalid=!1,e.forma.form.etiqueta.$invalid=!1,e.forma.form.control.$invalid=!1},e.limpiar=function(){e.habilitainput("control"),e.cat={},e.etiquetaslist=[],e.limpiar_error(),e.boperatoria=!1,$("#etiqueta").val(null),$("#caja").val(null),$("#operatoria").val(""),e.close_message()},e.habilitainput=function(a){switch(e.bcaja=!1,e.boperatoria=!1,e.betiqueta=!1,e.bcontrol=!1,e.bhabilitaoperatoria=!1,a){case"control":console.log("control"),e.bcontrol=!0,e.bcaja=!0,"ING"!==e.cat.subTipoTrasvase&&"INT"!==e.cat.subTipoTrasvase||(e.boperatoria=!0);break;case"caja":console.log("caja"),"ING"===e.cat.subTipoTrasvase||"INT"===e.cat.subTipoTrasvase?(e.boperatoria=!0,e.bhabilitaoperatoria=!0):e.betiqueta=!0;break;case"operatoria":console.log("operatoria"),e.boperatoria=!0,e.bhabilitaoperatoria=!0,e.betiqueta=!0}},e.habilitainput("control"),e.cerrar_caja=function(){e.openmodal()},e.openmodal=function(){o.open({animation:!0,templateUrl:"views/directives/modal_precinto_retorno.html",controller:"ModalRetornoController",backdrop:"static",keyboard:!1})},e.$watchCollection("etiquetaslist",function(a,o){void 0!==e.forma.form&&void 0!=a&&(e.bhabilita_cerrar=a.length>0)}),t.$on("CerrarCajaConfirm",function(){e.cerrar_caja_confirm()}),e.cerrar_caja_confirm=function(){var a=c.getObject(),t={idtrasvase:e.cat.idtrasvase,usuario:null,fechaRegistro:null,cajaId:null,precinto:a.precinto,status:1,precinto2:a.precinto2};n.setRestAngular("uptrasvasecajacab_retorno.action",t).then(function(a){console.log(a),c.setObject(a),c.setList(e.etiquetaslist),e.limpiar(),o.open({animation:!0,templateUrl:"views/directives/modal_creado_retornos.html",controller:"CreadoRetornoController",backdrop:"static",keyboard:!1})})["catch"](function(a){console.log(a),l.error(e,a.data.men)})}}]),angular.module("myApp").controller("ModalRetornoController",["$scope","$modal","$modalInstance","$rootScope","ValidaService","sharedProperties",function(e,a,o,t,r,i){e.modalform={},e.catform={},e.precinto_pattern=r.precinto_pattern(),e.close=function(){o.close()},e.cerrar_caja_confirm=function(){if(void 0!==e.modalform.form){if(!e.modalform.form.$valid)return void alert("Es necesario colocar los precintos para cerrar la caja.");o.close();var a=i.getObject();a.precinto=e.catform.precinto,a.precinto2=e.catform.precinto2,i.setObject(a),t.$emit("CerrarCajaConfirm",{})}},e.$watch("catform.precinto",function(a,o){void 0!==e.modalform.form&&void 0!=a&&""!=a&&(e.catform.precinto==e.catform.precinto2?e.modalform.form.precinto2.$setValidity("error_precinto",!1):e.modalform.form.precinto2.$setValidity("error_precinto",!0))}),e.$watch("catform.precinto2",function(a,o){void 0!==e.modalform.form&&void 0!=a&&""!=a&&(e.catform.precinto==e.catform.precinto2?e.modalform.form.precinto2.$setValidity("error_precinto",!1):e.modalform.form.precinto2.$setValidity("error_precinto",!0))})}]),angular.module("myApp").controller("CreadoRetornoController",["$scope","$modal","$timeout","$modalInstance","ConsultaService","sharedProperties","UtilService",function(e,a,o,t,r,i,n){e.modalform={},e.modal={},e.bdescargado=!1,e.bexcel=!1;var l=i.getObject();console.log("cat"),console.log(l),e.etiquetas_leidas=i.getList(),console.log("$scope.etiquetas_leidas"),console.log(e.etiquetas_leidas),e.close=function(){t.close()},e.show_message=function(){e.modal.mensaje="La caja S0"+l.cajaId+" se ha cerrado correctamente."},e.show_message(),e.descargar_remito=function(){e.bdescargado=!0,r.getBlobRestAngular("remito_trasvase_retornos.action?idtrasvase="+l.idtrasvase).then(function(e){console.log(e),r.showBlob(e,"remito_trasvase_"+l.idtrasvase+".pdf")})["catch"](function(e){console.log(e)})},e.descargar_excel=function(a){e.bexcel=!0;var t=n.tableToExcel(a,"Etiquetas leidas");null!==t&&o(function(){location.href=t},100)}}]),angular.module("myApp").controller("RecepcioncontrolcalidadController",["$scope","$timeout","$modal","$rootScope","$stateParams","ValidaService","ConsultaService","MessageService","sharedProperties",function(e,a,o,t,r,i,n,l,c){e.forma={},e.cat={},e.cat.totalValijas=0,e.valija={},e.error={},e.deta={},e.valijaslist=[],e.bhabilita_guardar=!1,e.bhabilita_faltantes=!1,e.bhabilita_rechazo=!1,e.numerico_pattern=i.numerico_pattern(),e.valija_pattern=i.valija_pattern(),e.precinto_pattern=i.precinto_pattern(),e.validar_lote=function(){return console.log(e.cat.idLote),void 0===e.cat.idLote||null===e.cat.idLote?void e.forma.form.lote.$setValidity("required",!1):void n.getRestAngular("valida_lote_control.action?idLote="+e.cat.idLote).then(function(a){console.log("lote"),console.log(a),e.cat=a,e.get_usuario(),e.habilitainput("valija"),e.listar_valijas(),c.setObject(e.cat),e.forma.form.lote.$invalid=!1,e.forma.form.lote.$error={},e.forma.form.persona_entrega.$touched=!0,e.bhabilita_rechazo=!0})["catch"](function(a){console.log(a),e.forma.form.lote.$setValidity("error_lote",!1),e.error.error_lote=a.data.men})},e.valija_action=function(){void 0!==e.valija.svalija&&$("#precinto").focus()},e.get_usuario=function(){n.getRestAngular("persona_entrega_recibe.action?idLote="+e.cat.idLote+"&status=2").then(function(a){console.log("usuario"),console.log(a),e.cat.personaEntrega=a.personaEntrega,e.cat.personaRecibe=a.personaRecibe})["catch"](function(e){console.log(e)})},e.validar_valija=function(){if(void 0===e.valija.svalija||null===e.valija.svalija)return void e.forma.form.valija.$setValidity("required",!1);if(void 0===e.valija.precinto||null===e.valija.precinto)return void e.forma.form.precinto.$setValidity("required",!1);if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("Debes colocar el nombre de la persona que recibe");var a={pk:{idLote:e.cat.idLote,nunico:Number(e.valija.svalija.substring(1))},scltcod:null,precinto:e.valija.precinto,fecha:null,usuario:null,status:4};n.setRestAngular("valida_lote_valijas_control.action",a).then(function(a){console.log(a),e.listar_valijas()})["catch"](function(a){console.log(a),e.forma.form.valija.$setValidity("error_valija",!1),e.error.error_valija=a.data.men}),e.valija.svalija=void 0,e.valija.precinto=void 0,$("#valija").val(null),$("#precinto").val(null),e.error={},e.forma.form.$error={},e.forma.form.valija.$error={},e.forma.form.precinto.$error={},e.forma.form.valija.$touched=!1,e.forma.form.precinto.$touched=!1,$("#valija").focus()},e.listar_valijas=function(){n.listRestAngular("lista_lote_valijas_control.action?idLote="+e.cat.idLote+"&status=3",null).then(function(a){console.log("valijaslist"),console.log(a),e.valijaslist=a,e.bhabilita_faltantes=e.valijaslist.length<e.cat.totalValijas})["catch"](function(a){console.log(a),e.bhabilita_faltantes=!0})},e.close_message=function(){l.close(e)},e.limpiar_error=function(){e.error={},e.forma.form.$error={},e.forma.form.lote.$error={},e.forma.form.valija.$error={},e.forma.form.precinto.$error={},e.forma.form.persona_entrega.$error={},e.forma.form.persona_recibe.$error={},e.forma.form.persona_entrega.$invalid=!1,e.forma.form.lote.$touched=!1,e.forma.form.valija.$touched=!1,e.forma.form.precinto.$touched=!1,e.forma.form.persona_entrega.$touched=!1,e.forma.form.persona_recibe.$touched=!1,e.bhabilita_faltantes=!1,e.bhabilita_rechazo=!1},e.habilitainput=function(a){switch(e.blote=!1,e.bpersonas=!1,e.bvalija=!1,a){case"lote":e.blote=!0;break;case"valija":e.bvalija=!0}},e.habilitainput("lote"),e.limpiar=function(){e.cat={},e.cat.totalValijas=0,e.valija={},e.valijaslist=[],$("#valija").val(null),$("#precinto").val(null),$("#lote").val(null),$("#persona_entrega").val(null),$("#persona_recibe").val(null),e.habilitainput("lote"),e.limpiar_error(),e.close_message()},e.guardar_restante=function(){c.setEstado("COMPLETO"),o.open({animation:!0,templateUrl:"views/directives/modal_creado.html",controller:"CreadoControlController",backdrop:"static",keyboard:!1})},e.guardar=function(){if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("Debes colocar el nombre de la persona que recibe");var a=window.confirm("¿En verdad deseas cerrar el lote?");if(1==a){var o=e.cat.idLote,t={idLote:o,scltcod:null,fecha:null,usuario:null,personaEntrega:e.cat.personaEntrega,personaRecibe:e.cat.personaRecibe};n.setRestAngular("save_lote_logistica_control.action",t).then(function(a){console.log(a),e.limpiar_error(),e.limpiar(),n.listRestAngular("lista_lote_valijas.action?idLote="+o+"&status=3",null).then(function(a){console.log("valijaslist leidas"),console.log(a),e.valijas_leidas=a,c.setList(e.valijas_leidas),e.guardar_restante()})["catch"](function(a){console.log(a),e.guardar_restante()})})["catch"](function(a){console.log(a),l.error(e,a.data.men)})}},e.ver_faltantes=function(){o.open({animation:!0,templateUrl:"views/directives/modal_faltantes.html",controller:"FaltantesControlController",backdrop:"static",keyboard:!1})},e.$watchCollection("valijaslist",function(a,o){void 0!==e.forma.form&&void 0!=a&&a.length>0&&(e.bhabilita_parcial=a.length<e.cat.totalValijas,e.bhabilita_guardar=a.length==e.cat.totalValijas)}),e.rechazar_lote=function(){c.setObject(e.cat),c.setEstado("RECHAZO"),o.open({animation:!0,templateUrl:"views/directives/modal_parcial.html",controller:"RechazarController",backdrop:"static",keyboard:!1})},e.guardar_parcial=function(){c.setObject(e.cat),c.setEstado("PARCIAL"),o.open({animation:!0,templateUrl:"views/directives/modal_parcial.html",controller:"ParcialControlCalidadController",backdrop:"static",keyboard:!1})},t.$on("Limpiar",function(){e.limpiar()})}]),angular.module("myApp").controller("FaltantesControlController",["$scope","$modal","$modalInstance","ConsultaService","sharedProperties","UtilService",function(e,a,o,t,r,i){e.modalform={},e.modal={},e.faltanteslist=[],e.close=function(){o.close()},e.listar_faltantes=function(){var a=r.getObject();t.listRestAngular("lista_lote_valijas_control.action?idLote="+a.idLote+"&status=2",null).then(function(a){console.log("faltantes"),console.log(a),e.faltanteslist=a})["catch"](function(e){console.log(e)})},e.listar_faltantes(),e.exportar_faltantes=function(e){var a=i.tableToExcel(e,"valijas faltantes");null!==a&&$timeout(function(){location.href=a},100)}}]),angular.module("myApp").controller("RechazarController",["$scope","$modal","$rootScope","$modalInstance","ConsultaService","sharedProperties",function(e,a,o,t,r,i){e.modalform={},e.modal={},e.valijas_leidas=[],e.status_leidas=3,e.bvalijastodas=!0;var n=i.getObject();e.close=function(){t.close()},e.listar_valijas_pendientes=function(){r.listRestAngular("lista_lote_valijas.action?idLote="+n.idLote+"&status=2",null).then(function(a){console.log("valijaslist pendientes"),console.log(a),e.valijas_leidas.concat(a),i.setList(e.valijas_leidas)})["catch"](function(e){console.log(e)})},e.listar_valijas_leidas=function(){r.listRestAngular("lista_lote_valijas.action?idLote="+n.idLote+"&status=3",null).then(function(a){console.log("valijaslist leidas"),console.log(a),e.valijas_leidas=a,e.listar_valijas_pendientes()})["catch"](function(e){console.log(e)})},e.rechazar_restante2=function(){console.log("rechazar_restante2"),e.close(),i.setList(e.valijas_leidas),a.open({animation:!0,templateUrl:"views/directives/modal_creado.html",controller:"CreadoControlController",backdrop:"static",keyboard:!1})},e.rechazar_restante=function(){console.log("rechazar_restante"),r.listRestAngular("lista_lote_valijas.action?idLote="+n.idLote+"&status=2",null).then(function(a){console.log("valijaslist pendientes"),console.log(a),e.valijas_leidas=e.valijas_leidas.concat(a),e.rechazar_restante2()})["catch"](function(a){console.log(a),e.rechazar_restante2()})},e.rechazar=function(){console.log("rechazar"),o.$emit("Limpiar",{});var a={idLote:n.idLote,scltcod:null,fecha:null,usuario:null,personaEntrega:n.personaEntrega,personaRecibe:n.personaRecibe,observaciones:e.modal.observaciones};r.setRestAngular("rechazar_lote_control.action",a).then(function(a){console.log(a),r.listRestAngular("lista_lote_valijas.action?idLote="+n.idLote+"&status=3",null).then(function(a){console.log("valijaslist leidas"),console.log(a),e.valijas_leidas=a,e.rechazar_restante()})["catch"](function(a){e.valijas_leidas=[],e.rechazar_restante(),console.log(a)})})["catch"](function(e){console.log(e)})}}]),angular.module("myApp").controller("CreadoControlController",["$scope","$modal","$timeout","$modalInstance","ConsultaService","sharedProperties","UtilService",function(e,a,o,t,r,i,n){e.modalform={},e.modal={},e.bdescargado=!1,e.bexcel=!1,e.status_leidas=3;var l=i.getObject(),c=i.getEstado();console.log("estado"),console.log(c),e.valijas_leidas=i.getList(),console.log("$scope.valijas_leidas"),console.log(e.valijas_leidas),e.close=function(){t.close()},e.show_message=function(){e.modal.mensaje="El lote "+l.idLote+" se ha guardado correctamente."},e.show_message(),e.descargar_remito=function(){e.bdescargado=!0;var a;a="RECHAZO"==c?"remito_control_calidad.action?idLote="+l.idLote+"&status=5":"remito_control_calidad.action?idLote="+l.idLote+"&status=3",r.getBlobRestAngular(a).then(function(e){console.log(e),r.showBlob(e,"remito_lote_"+l.idLote+".pdf")})["catch"](function(e){console.log(e)})},e.descargar_excel=function(a){e.bexcel=!0;var t=n.tableToExcel(a,"valijas recibidas");null!==t&&o(function(){location.href=t},100)}}]),angular.module("myApp").controller("ParcialControlCalidadController",["$scope","$modal","$rootScope","$modalInstance","ConsultaService","sharedProperties",function(e,a,o,t,r,i){e.modalform={},e.modal={},e.valijas_leidas=[],e.status_leidas=3,e.bvalijastodas=!0;var n=i.getObject();e.close=function(){t.close()},e.listar_valijas_pendientes=function(){r.listRestAngular("lista_lote_valijas.action?idLote="+n.idLote+"&status=2",null).then(function(a){console.log("valijaslist pendientes"),console.log(a),e.valijas_leidas.concat(a),i.setList(e.valijas_leidas)})["catch"](function(e){console.log(e)})},e.listar_valijas_leidas=function(){r.listRestAngular("lista_lote_valijas.action?idLote="+n.idLote+"&status=3",null).then(function(a){console.log("valijaslist leidas"),console.log(a),e.valijas_leidas=a,e.listar_valijas_pendientes()})["catch"](function(e){console.log(e)})},e.guardar_parcial_restante2=function(){console.log("guardar_parcial_restante2"),e.close(),i.setList(e.valijas_leidas),a.open({animation:!0,templateUrl:"views/directives/modal_creado.html",controller:"CreadoControlController",backdrop:"static",keyboard:!1})},e.guardar_parcial_restante=function(){console.log("guardar_parcial_restante"),r.listRestAngular("lista_lote_valijas.action?idLote="+n.idLote+"&status=2",null).then(function(a){console.log("valijaslist pendientes"),console.log(a),e.valijas_leidas=e.valijas_leidas.concat(a),e.guardar_parcial_restante2()})["catch"](function(a){console.log(a),e.guardar_parcial_restante2()})},e.guardar_parcialmente=function(){console.log("guardar_parcialmente"),o.$emit("Limpiar",{});var a={idLote:n.idLote,scltcod:null,fecha:null,usuario:null,personaEntrega:n.personaEntrega,personaRecibe:n.personaRecibe,observaciones:e.modal.observaciones};r.setRestAngular("guardar_parcial_lote_control.action",a).then(function(a){console.log(a),r.listRestAngular("lista_lote_valijas.action?idLote="+n.idLote+"&status=3",null).then(function(a){console.log("valijaslist leidas"),console.log(a),e.valijas_leidas=a,e.guardar_parcial_restante()})["catch"](function(a){e.valijas_leidas=[],e.guardar_parcial_restante(),console.log(a)})})["catch"](function(e){console.log(e)})}}]),angular.module("myApp").controller("RetiroCajasController",["$scope","$timeout","$modal","$rootScope","$stateParams","ValidaService","ConsultaService","MessageService","sharedProperties",function(e,a,o,t,r,i,n,l,c){function s(){n.getRestAngular("usuario.action").then(function(a){console.log("usuario"),console.log(a),e.cat.personaEntrega=a.user.nombre})["catch"](function(e){console.log(e)})}function u(){e.error={},e.error.error_caja=void 0,e.error.error_precinto2=void 0,e.forma.form.$error={},e.forma.form.caja.$error={},e.forma.form.precinto.$error={},e.forma.form.precinto2.$error={},e.forma.form.persona_entrega.$error={},e.forma.form.persona_recibe.$error={},e.forma.form.caja.$invalid=!1,e.forma.form.persona_entrega.$invalid=!1,e.forma.form.persona_recibe.$invalid=!1,e.forma.form.precinto.$invalid=!1,e.forma.form.precinto2.$invalid=!1,e.forma.form.caja.$touched=!1,e.forma.form.persona_entrega.$touched=!1,e.forma.form.persona_recibe.$touched=!1,e.forma.form.precinto.$touched=!1,e.forma.form.precinto2.$touched=!1}function d(o){switch(e.bcaja=!1,e.bprecinto=!1,e.bprecinto2=!1,o){case"persona_recibe":e.bcaja=!0,a(function(){$("#persona_recibe").focus()});break;case"caja":e.bcaja=!0,a(function(){$("#caja").focus()});break;case"precinto":e.bprecinto=!0,a(function(){$("#precinto").focus()});break;case"precinto2":e.bprecinto2=!0,a(function(){$("#precinto2").focus()})}}function f(){n.getRestAngular("limpia_cajas_retiro.action").then(function(e){console.log(e)})["catch"](function(e){console.log(e)})}e.forma={},e.cat={},e.caja={},e.error={},e.cajaslist=[],e.bhabilita_guardar=!1,e.caja_pattern=i.caja_pattern(),e.precinto_pattern=i.precinto_pattern(),s(),f(),d("persona_recibe"),e.caja_action=function(){if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("No se encontró el nombre de la persona que recibe");if(void 0!=e.caja.scaja){var a=e.caja.scaja.substring(1);n.getRestAngular("valida_caja_retiro.action?cajaId="+a).then(function(e){console.log("caja_action"),console.log(e),d("precinto"),u()})["catch"](function(a){console.log(a),e.caja.scaja=void 0,e.forma.form.caja.$setValidity("error_caja",!1),e.error.error_caja=a.data.men})}},e.precinto_action=function(){void 0!==e.caja.precinto&&d("precinto2")},e.quitar_item=function(a){n.getRestAngular("limpia_cajas_retiro.action?idtrasvase="+a).then(function(a){console.log("limpia_cajas_retiro"),console.log(a),e.listar_cajas()})["catch"](function(e){console.log(e)})},e.validar_caja_precintos=function(){return void 0===e.cat.personaEntrega||null===e.cat.personaEntrega?void alert("Debes colocar el nombre de la persona que entrega"):void 0===e.cat.personaRecibe||null===e.cat.personaRecibe?void alert("Debes colocar el nombre de la persona que recibe"):void 0===e.caja.scaja||null===e.caja.scaja?void e.forma.form.caja.$setValidity("required",!1):void 0===e.caja.precinto||null===e.caja.precinto?void e.forma.form.precinto.$setValidity("required",!1):void 0===e.caja.precinto2||null===e.caja.precinto2?void e.forma.form.precinto2.$setValidity("required",!1):e.caja.precinto===e.caja.precinto2?(e.forma.form.precinto2.$setValidity("error_precinto2",!1),void(e.error.error_precinto2="El precinto 2 es el mismo colocado en el precinto 1")):void n.getRestAngular("valida_caja_precintos_retiro.action?cajaId="+e.caja.scaja.substring(1)+"&precinto="+e.caja.precinto+"&precinto2="+e.caja.precinto2).then(function(a){console.log("validar_caja_precintos"),console.log(a),e.listar_cajas(),e.caja.scaja=void 0,e.caja.precinto=void 0,e.caja.precinto2=void 0,$("#valija").val(null),$("#precinto").val(null),$("#precinto2").val(null),u(),d("caja")})["catch"](function(a){console.log(a),e.forma.form.precinto2.$setValidity("error_precinto2",!1),
e.error.error_precinto2=a.data.men})},e.listar_cajas=function(){n.listRestAngular("lista_cajas_retiro.action",null).then(function(a){console.log("cajaslist"),console.log(a),e.cajaslist=a})["catch"](function(e){console.log(e)})},e.close_message=function(){l.close(e)},e.limpiar_caja=function(){e.caja={},$("#valija").val(null),$("#precinto").val(null),$("#precinto2").val(null),e.error.error_caja=void 0,e.error.error_precinto2=void 0,e.forma.form.$error={},e.forma.form.caja.$error={},e.forma.form.precinto.$error={},e.forma.form.precinto2.$error={},e.forma.form.caja.$invalid=!1,e.forma.form.precinto.$invalid=!1,e.forma.form.precinto2.$invalid=!1,e.forma.form.caja.$touched=!1,e.forma.form.precinto.$touched=!1,e.forma.form.precinto2.$touched=!1,d("caja")},e.limpiar=function(){e.cat={},e.caja={},e.cajaslist=[],$("#valija").val(null),$("#precinto").val(null),$("#precinto2").val(null),$("#persona_entrega").val(null),u(),d("caja"),e.close_message(),s(),f()},e.guardar=function(){if(void 0===e.cat.personaEntrega||null===e.cat.personaEntrega)return void alert("Debes colocar el nombre de la persona que entrega");if(void 0===e.cat.personaRecibe||null===e.cat.personaRecibe)return void alert("Debes colocar el nombre de la persona que recibe");var a=window.confirm("¿En verdad deseas Generar el Recibo para cerrar la lectura?");if(1==a){var t={idRetiro:null,usuario:null,fechaRetiro:null,personaEntrega:e.cat.personaEntrega,personaRecibe:e.cat.personaRecibe};n.setRestAngular("guardar_retiro_cajas.action",t).then(function(a){console.log("guardar_retiro_cajas.action"),console.log(a),c.setObject(a),e.limpiar(),o.open({animation:!0,templateUrl:"views/directives/modal_retiro.html",controller:"ModalRetiradaController",backdrop:"static",keyboard:!1})})["catch"](function(a){console.log(a),l.error(e,a.data.men)})}},e.ver_modal=function(){o.open({animation:!0,templateUrl:"views/directives/modal_retiro.html",controller:"ModalRetiradaController",backdrop:"static",keyboard:!1})},e.$watchCollection("cajaslist",function(a,o){e.bhabilita_guardar=!1,void 0!==e.forma.form&&void 0!=a&&a.length>0&&(e.bhabilita_guardar=!0)})}]),angular.module("myApp").controller("ModalRetiradaController",["$scope","$modal","$timeout","$modalInstance","ConsultaService","sharedProperties",function(e,a,o,t,r,i){e.modalform={},e.modal={},e.bdescargado=!1;var n=i.getObject();e.close=function(){t.close()},e.show_message=function(){e.modal.mensaje="Se ha realizado el retiro correctamente."},e.show_message(),e.descargar_remito=function(){e.bdescargado=!0,r.getBlobRestAngular("remito_retiro_cajas.action?idRetiro="+n.idRetiro).then(function(e){console.log(e),r.showBlob(e,"retiro_"+n.idRetiro+".pdf")})["catch"](function(e){console.log(e)})}}]),angular.module("myApp").controller("RecepcioncapturaController",["$scope","$timeout","$modal","$rootScope","$stateParams","ValidaService","ConsultaService","MessageService","sharedProperties",function(e,a,o,t,r,i,n,l,c){function s(a){n.getRestAngular("get_sucursales.action?tipoflujo="+a).then(function(a){e.sucursaleslist=a})["catch"](function(e){console.log(e)})}function u(a){switch(a){case"1":e.folio_pattern=e.numerico_pattern;break;case"2":e.folio_pattern=e.alfanumerico_pattern}}function d(a,o){var t=e.listafull;if(void 0!=t&&null!=t)for(var r in t){var i=t[r];for(var n in i)if("tiporecepcion"==n&&i[n]==o&&i.etiqueta==a)return!0}return!1}function f(){e.modal.titulo_confirm="Relación valija - sucursal",e.modal.mensaje_confirm="La valija actual será relacionada con la sucursal seleccionada, ¿Es correcto?",angular.element("#modalConfirm").modal("show")}function m(a){n.getRestAngular("get_expedientes_recepcion.action?idRecepcion="+a).then(function(a){console.log("listar"),console.log(a),e.listafull=a,e.paginacion(1),p(a)})["catch"](function(a){console.log(a),e.listafull=[],e.lista=[],p(e.listafull)})}function p(a){if(e.no_valijas=0,e.no_cajas=0,e.no_expedientes=0,void 0!=a&&a.length>0)for(var o in a)if(a.hasOwnProperty(o)){var t=a[o];for(var r in t)if(t.hasOwnProperty(r)&&"tiporecepcion"==r)switch(t[r]){case 1:e.no_valijas=e.no_valijas+1;break;case 2:e.no_cajas=e.no_cajas+1;break;case 3:e.no_expedientes=e.no_expedientes+1}}}e.forma={},e.cat={},e.error={},e.no_cajas=0,e.no_valijas=0,e.no_expedientes=0,e.expedienteslist=[],e.bhabilita_guardar=!1,e.caja_pattern=i.caja_pattern(),e.expediente_pattern=i.expediente_pattern(),e.valija_pattern=i.valija_pattern(),e.numerico_pattern=i.numerico_pattern(),e.alfanumerico_pattern=i.alfanumerico_pattern(),e.modal={},e.currentPage=1,e.numPerPage=5,e.maxSize=5,e.listafull=[];var v=1596;e.get_tipo_recepcion=function(){n.getRestAngular("get_tipo_recepcion.action").then(function(a){e.tiporecepcionlist=a})["catch"](function(e){console.log(e)})},e.get_tipo_recepcion(),e.get_incidencias=function(){n.getRestAngular("get_incidencias.action").then(function(a){e.incidenciaslist=a})["catch"](function(e){console.log(e)})},e.get_incidencias(),e.habilitainput=function(o){switch(e.btipoflujo=!1,e.btiporecepcion=!1,e.bsucursal=!1,e.bincidencia=!1,e.bcaja=!1,e.bvalija=!1,e.bsegurisello=!1,e.bexpediente=!1,o){case"tipoflujo":e.btipoflujo=!0;break;case"tipo_recepcion":e.btiporecepcion=!0;break;case"sucursal":e.bsucursal=!0;break;case"incidencia":e.bincidencia=!0;break;case"expediente":switch(e.cat.tipo_recepcion){case"1":e.bvalija=!0,a(function(){$("#valija").focus()});break;case"2":e.bcaja=!0,a(function(){$("#caja").focus()});break;case"3":e.bexpediente=!0,a(function(){$("#expediente").focus()})}}},e.habilitainput("tipoflujo"),e.muestrarecepcion=function(a){switch(e.bshowcaja=!1,e.bshowvalija=!1,e.bshowsegurisello=!1,a){case"caja":e.bshowcaja=!0;break;case"valija":e.bshowvalija=!0,e.bshowsegurisello=!0}},e.muestracredito=function(a){switch(e.bshowcredito=!1,e.bshowfolio=!1,a){case"credito":e.bshowcredito=!0;break;case"folio":e.bshowfolio=!0}},e.$watch("cat.tipoflujo",function(a,o){void 0!==e.forma.form&&(void 0!=a&&""!=a?(e.habilitainput("tipo_recepcion"),e.forma.form.tipo_flujo.$setValidity("required",!0),e.bnuevarecepcion=!0,s(a),u(a)):(e.forma.form.tipo_flujo.$setValidity("required",!1),e.bnuevarecepcion=!1))}),e.$watch("cat.tipo_recepcion",function(a,o){if(void 0!==e.forma.form)if(void 0!=a&&""!=a){e.habilitainput("sucursal");var t;switch(a){case"1":t="valija";break;case"2":t="caja";break;case"3":t="expediente"}e.muestrarecepcion(t),e.forma.form.tipo_recepcion.$setValidity("required",!0)}else e.forma.form.tipo_recepcion.$setValidity("required",!1)}),e.$watch("cat.sucursal",function(a,o){if(void 0!==e.forma.form)if(void 0!=a&&""!=a)switch(e.habilitainput("incidencia"),e.forma.form.sucursal.$setValidity("required",!0),a){case"1596":e.muestracredito("credito");break;case"1595":e.muestracredito("credito");case"1601":e.muestracredito("credito");break;default:e.muestracredito("folio")}else e.forma.form.sucursal.$setValidity("required",!1)}),e.$watch("cat.incidencia",function(a,o){void 0!==e.forma.form&&(void 0!=a&&""!=a?(e.habilitainput("expediente"),e.forma.form.incidencia.$setValidity("required",!0)):e.forma.form.incidencia.$setValidity("required",!1))}),e.caja_action=function(){if(void 0!=e.cat.caja){if(1==d(e.cat.caja,2))return e.forma.form.caja.$setValidity("error_caja",!1),e.error.error_caja="La caja ya fue agregada al listado",null;e.forma.form.caja.$setValidity("error_caja",!0),e.error.error_caja=void 0,e.bcaja=!1,e.bexpediente=!0,a(function(){$("#expediente").focus()})}},e.valija_action=function(){if(void 0!=e.cat.valija){if(1==d(e.cat.valija,1))return e.forma.form.valija.$setValidity("error_valija",!1),e.error.error_valija="La valija ya fue agregada al listado",null;e.forma.form.valija.$setValidity("error_valija",!0),e.error.error_valija=void 0,n.getRestAngular("get_no_relaciones_valija.action?ssccod="+e.cat.sucursal).then(function(a){console.log("valija_action"),console.log(a);var o=a.no_relaciones;o>=5?(e.modal.titulo="Relación valija - sucursal",e.modal.mensaje="La sucursal ya tiene "+o+" valijas relacionadas",angular.element("#modalMensajes").modal("show")):f()})["catch"](function(e){console.log(e)})}},e.segurisello_action=function(){void 0!=e.cat.segurisello&&(e.bsegurisello=!1,e.bexpediente=!0,a(function(){$("#expediente").focus()}))},e.expediente_action=function(){void 0!=e.cat.expediente&&n.getRestAngular("valida_expediente_recepcion.action?expediente="+e.cat.expediente).then(function(o){console.log("valida_expediente_recepcion"),console.log(o),e.bexpediente=!1,e.error.error_expediente=null,e.forma.form.expediente.$setValidity("error_expediente",!0),a(function(){e.bshowcredito?(e.bcredito=!0,a(function(){$("#credito").focus()})):(e.bfolio=!0,a(function(){$("#folio").focus()}))})})["catch"](function(a){console.log(a),e.forma.form.expediente.$setValidity("error_expediente",!1),e.error.error_expediente=a.data.men})},e.folio_action=function(){if(void 0!=e.cat.folio){var o={idRecepcion:e.cat.idrecepcion,tipoflujo:e.cat.tipoflujo,tiporecepcion:e.cat.tipo_recepcion,ssccod:e.cat.sucursal,incidencia:e.cat.incidencia,etiqueta:1==e.cat.tipo_recepcion?e.cat.valija:e.cat.caja,segurisello:e.cat.segurisello,expediente:Number(e.cat.expediente.substring(1)),folioSEA:1==e.cat.tipoflujo?e.cat.folio:null,folioPYME:2==e.cat.tipoflujo?e.cat.folio:null};n.setRestAngular("valida_folio_recepcion.action",o).then(function(o){console.log("valida_folio_recepcion"),console.log(o),e.bexpediente=!0,e.bfolio=!1,e.cat.expediente=null,e.cat.folio=null,e.cat.idrecepcion=o.idRecepcion,e.cat.producto=o.producto,e.forma.form.folio.$error={},e.forma.form.folio.$touched=!1,e.forma.form.expediente.$error={},e.forma.form.expediente.$touched=!1,e.forma.form.expediente.$invalid=!1,1==e.cat.tipoflujo&&0==o.statusFolio&&(e.modal.titulo="FOLIO",e.modal.mensaje="El folio: "+o.folioSEA+" no se encontró en la base cliente, se marcará como no conciliado",angular.element("#modalMensajes2").modal("show")),a(function(){$("#expediente").focus()}),m(e.cat.idrecepcion)})["catch"](function(a){console.log(a),e.forma.form.folio.$setValidity("error_folio",!1),e.error.error_folio=a.data.men})}else e.forma.form.folio.$invalid=!0},e.credito_action=function(){void 0!=e.cat.credito&&(e.bshowcredito=!1,e.cat.creditoinverso=void 0,angular.element("#modalCreditoInverso").modal("show"),a(function(){e.error.error_creditoinverso=void 0,$("#creditoinverso").focus()},500))},e.bcredito=!0,e.credito_inverso_action=function(){if(void 0!=e.cat.creditoinverso){if(e.cat.credito!=i.invertir_cadena(e.cat.creditoinverso))return e.error.error_creditoinverso="El crédito inverso es incorrecto",null;angular.element("#modalCreditoInverso").modal("hide"),e.bshowcredito=!0;var o={idRecepcion:e.cat.idrecepcion,tipoflujo:e.cat.tipoflujo,tiporecepcion:e.cat.tipo_recepcion,ssccod:e.cat.sucursal,incidencia:e.cat.incidencia,etiqueta:1==e.cat.tipo_recepcion?e.cat.valija:e.cat.caja,segurisello:e.cat.segurisello,expediente:Number(e.cat.expediente.substring(1)),credito:e.cat.credito,folioSEA:null,folioPYME:null};n.setRestAngular("valida_credito_recepcion.action",o).then(function(o){console.log("valida_credito_recepcion"),console.log(o),e.cat.idrecepcion=o.idRecepcion,1==e.cat.tipoflujo?e.cat.sucursal==v&&0==o.statusFolio&&(e.modal.titulo="CRÉDITO",e.modal.mensaje="El crédito: "+o.credito+" no se encontró en la base cliente, se marcará como no conciliado.",angular.element("#modalMensajes2").modal("show")):3==e.cat.tipoflujo&&1==o.bnuevoIngreso&&(e.modal.titulo="CRÉDITO",e.modal.mensaje="El crédito: "+o.credito+" no se encontró en custodia AdeA, se marcará como nuevo ingreso",angular.element("#modalMensajes2").modal("show")),e.bexpediente=!0,e.bcredito=!1,e.cat.expediente=null,e.cat.credito=null,a(function(){e.forma.form.credito.$error={},e.forma.form.credito.$touched=!1,e.error.error_credito=null,e.forma.form.credito.$setValidity("error_credito",!0),e.forma.form.expediente.$error={},e.forma.form.expediente.$touched=!1,e.forma.form.expediente.$invalid=!1,$("#expediente").focus()}),m(e.cat.idrecepcion)})["catch"](function(a){console.log(a),e.forma.form.credito.$setValidity("error_credito",!1),e.error.error_credito=a.data.men}),m(e.cat.idrecepcion)}else e.error.error_creditoinverso="Debes colocar el crédito inverso"},e.credito_inverso_cancelar=function(){e.bshowcredito=!0,angular.element("#modalCreditoInverso").modal("hide"),a(function(){$("#credito").focus()})},e.paginacion=function(a){e.currentPage=a;var o=(e.currentPage-1)*e.numPerPage,t=o+e.numPerPage;e.lista=e.listafull.slice(o,t)},e.limpiar_error=function(){e.error={},e.forma.form.$error={},e.forma.form.tipo_flujo.$error={},e.forma.form.tipo_flujo.$touched=!1,e.forma.form.tipo_recepcion.$error={},e.forma.form.tipo_recepcion.$touched=!1,e.forma.form.sucursal.$error={},e.forma.form.sucursal.$touched=!1,e.forma.form.incidencia.$error={},e.forma.form.incidencia.$touched=!1,void 0!=e.forma.form.caja&&(e.forma.form.caja.$error={},e.forma.form.caja.$touched=!1),void 0!=e.forma.form.valija&&(e.forma.form.valija.$error={},e.forma.form.valija.$touched=!1),void 0!=e.forma.form.segurisello&&(e.forma.form.segurisello.$error={},e.forma.form.segurisello.$touched=!1),void 0!=e.forma.form.credito&&(e.forma.form.credito.$error={},e.forma.form.credito.$touched=!1),void 0!=e.forma.form.folio&&(e.forma.form.folio.$error={},e.forma.form.folio.$touched=!1),e.forma.form.expediente.$error={},e.forma.form.expediente.$touched=!1},e.limpiar=function(){e.cat={},e.listafull=[],e.lista=[],p(e.listafull),e.habilitainput("tipoflujo"),e.muestrarecepcion(null),e.limpiar_error(),e.close_message()},e.eliminar_etiqueta=function(a,o,t){var r,i;switch(o){case 1:r="la valija",i=" y todo su contenido";break;case 2:r="la caja",i=" y todo su contenido";break;case 3:r="el expediente",i=""}var l="¿En verdad deseas eliminar "+r+": "+t+i+"?",c=window.confirm(l);1==c&&n.getRestAngular("delete_etiqueta_recepcion.action?idRecepcion="+a+"&etiqueta="+t+"&tiporecepcion="+o).then(function(a){m(e.cat.idrecepcion)})["catch"](function(e){console.log(e)})},e.nueva_recepcion=function(){var a=e.cat.tipoflujo,o=e.cat.idrecepcion;e.cat={},e.cat.tipoflujo=a,e.cat.idrecepcion=o,e.habilitainput("tipo_recepcion"),e.muestrarecepcion(null),e.muestracredito(null),e.limpiar_error()},e.close_message=function(){l.close(e)},e.close_modal=function(){angular.element("#modalMensajes").modal("hide"),f()},e.close_modal2=function(){angular.element("#modalMensajes2").modal("hide"),a(function(){$("#expediente").focus()})},e.aceptar_modal=function(){n.getRestAngular("save_relacion_valija.action?ssccod="+e.cat.sucursal+"&valija="+e.cat.valija).then(function(o){e.bvalija=!1,e.bsegurisello=!0,angular.element("#modalConfirm").modal("hide"),a(function(){$("#segurisello").focus()})})["catch"](function(e){console.log(e)})},e.cancelar_modal=function(){angular.element("#modalConfirm").modal("hide")}}]);